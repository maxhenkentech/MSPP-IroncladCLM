# Ironclad CLM and SCIM API Custom Connector for Microsoft Power Platform

This repository hosts the Microsoft Power Platform custom connector for Ironclad Contract Lifecycle Management (CLM) and System for Cross-domain Identity Management (SCIM) APIs. Developed by LEG Technologies and Operations at Amadeus IT Group, S.A., and supported by Ironclad product management, this connector facilitates seamless interactions with Ironclad's APIs, allowing enhanced automation and data management capabilities within Power Platform.
## Features

1. Comprehensive Integration with Ironclad**: The connector provides seamless interaction with Ironclad’s CLM and SCIM APIs, enabling users to automate contract workflows, manage identity data, and integrate these capabilities into broader Power Platform applications.
2. Data Type Compatibility and Flexibility**: The connector utilizes a custom C# script (script.csx) to handle non-OpenAPI compliant schemas and data types, ensuring that even complex or non-standard data can be processed smoothly. It also supports dynamic schema parsing for both request and response payloads, enhancing the flexibility and robustness of your workflows.
3. Multi-Environment Authentication Support**: The connector supports multiple OAuth 2.0 authentication methods, including the OAuth 2.0 code grant flow and client credentials flow. It is designed to work across various Ironclad environments, including production, sandbox, and preview environments, providing versatile support for different deployment scenarios. Users can specify the Actor (user) when using client credentials to ensure proper authorization and audit trails.
4. Real-Time Workflow Automation**: The connector allows for the initiation of workflows based on real-time triggers, such as webhooks. This feature is particularly powerful for automating contract management tasks, ensuring that critical business processes are executed as soon as specific events occur in Ironclad.
5. Environment-Specific Configuration**: The connector supports customization based on the environment in which it is deployed. Users can easily configure the base URLs to match the appropriate Ironclad environment (e.g., US, EU1, demo, preview), ensuring that the connector behaves correctly in different contexts.
6. Broad API Endpoint Support**: The connector is equipped to handle a wide range of API endpoints for managing workflows, records, users, and groups. This includes endpoints for creating, retrieving, updating, and deleting workflows and records, as well as managing SCIM users and groups.
## Prerequisites

Before you begin setting up the connector, ensure you have the following:

1. An active Ironclad account with API access enabled.
2. Administrator access to your Ironclad instance to set up API credentials.
3. Microsoft Power Platform environment where you'll be using the connector.
## Current Limitations

1. The custom connector is currently available for PowerAutomate only. This is because PowerApps does not support implicit properties and certain operations rely on implicit value payloads (e.g.: UpdateWorkflowMetadata);
2. Including a file is currently not supported on operations that also include other metadata. This is because the Ironclad api uses formData as the schema for some of these calls and swagger does not support combining formData parameters with body parameters. As such, it is not possible to obtain additional input from the user when formData should be sent.
## Obtaining API Credentials

To use this connector, you'll need to obtain API credentials from Ironclad. Follow these steps:

1. Log in to your Ironclad admin panel.
2. Navigate to the API settings section (the exact path may vary depending on your Ironclad version).
3. Create a new API client, which will generate a client ID and client secret.
4. Enable the authentication methods you want to use.
5. Make note of the client ID and client secret - you'll need these when configuring the connector.

> [!WARNING] Client Credential Support
> The client credential authentication is not natively supported by MS PowerPlatform. This custom connector uses a known workaround by pretending to do a code exchange in the client credential flow, although this is not required for token generation. As such, Authorization Code must remain enabled as a grant type for client Client Credential Authentication is used. You must also add the custom connector redirect URL to Ironclad, as described below.
## Setting Up the Callback URL

The callback URL is crucial for the OAuth 2.0 flow. To set it up:

1. After installing the connector (see Setup Instructions below), go to the Security tab in the custom connector settings.
2. Switch the authentication method to OAuth 2.0 to reveal the callback URL.
3. Copy this callback URL.
4. In your Ironclad admin panel, add this URL to the list of authorized callback URLs for your API client.

**Important:** Do not save the connector settings after switching to OAuth 2.0 at this stage, as it may cause configuration issues.
## Deploying to PowerPlatform

1. **Install via `paconn`**:
   - Ensure you have `paconn` installed and updated.
   - Log into `paconn`:
     ```bash
     paconn login
     ```
   - Create the connector:
     ```bash
     paconn create --api-prop apiProperties.json --api-def apiDefinition.swagger.json --icon icon.png --script script.csx --secret dummy
     ```
   You do not need to replace the dummy secret with your own. Each connection owner will need to provide their own client Id and Secret during creation of the connection and we recommend to issue separate client ids and secrets to each application as a matter of best practice. Once the connector had been pushed to your the environment selected during creation, you can update the custom connector code and update the deployed connector using:
    ```bash
     paconn update -s settings.json --secret dummy
     ```
1. **Configure OAuth 2.0**:
   - In the Power Platform custom connector UI, go to the Security tab.
   - Switch the authentication method to OAuth 2.0.
   - Copy the callback URL, but **DO NOT CLICK "UPDATE CONNECTOR"**. Just close the window.
   - Add this callback URL to your Ironclad API client settings as described in the "Setting Up the Callback URL" section.
2. **Complete Connector Configuration**:
   - When adding you first action in your flow, you will be asked to create a connection reference. Fill in the client ID and client secret obtained from the Ironclad admin panel.
   - Update the `Host` parameter in the Definition tab to match your Ironclad environment (e.g., `api.ironcladapp.com` for production).
   - Save the connection.
## API Endpoint Support

### Workflows
| Endpoint                                                                                                                                 | Method  | Path                                                       | Support | Operation Id                    | Comments                                                                                                                                                                                                                                                                                                   | Script |
| ---------------------------------------------------------------------------------------------------------------------------------------- | ------- | ---------------------------------------------------------- | :-----: | ------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :----: |
| [Create a Workflow Synchronously](https://developer.ironcladapp.com/reference/launch-a-new-workflow)                                     | `POST`  | `/workflows`                                               |    P    | `CreateWorkflow`                | Partially supported with dynamic ui schema in request and response. Sending files is not supported.                                                                                                                                                                                                        |  Yes   |
| [Create a Workflow Synchronously](https://developer.ironcladapp.com/reference/launch-a-new-workflow)                                     | `POST`  | `/workflows/async`                                         |    P    | `CreateWorkflowAsync`           | Partially supported with dynamic ui schema. supported.                                                                                                                                                                                                                                                     |  Yes   |
| [Retrieve the Status of an Async Workflow Create Job](https://developer.ironcladapp.com/reference/retrieve-asynchronous-workflow-status) | `GET`   | `/workflows/async/{AsyncJob}`                              |    S    | `RetrieveAsyncJobStatus`        | Fully supported with dynamic ui schema in request and response.                                                                                                                                                                                                                                            |   No   |
| [List All Workflows](https://developer.ironcladapp.com/reference/list-all-workflows)                                                     | `GET`   | `/workflows`                                               |    S    | `ListAllWorkflows`              | Workflow attributes are not parsed dynamically. Use `RetrieveWorkflow` for dynamic schema on response.                                                                                                                                                                                                     |   No   |
| [Retrieve a Workflow](https://developer.ironcladapp.com/reference/retrieve-a-workflow)                                                   | `GET`   | `/workflows/{Workflow}`                                    |    S    | `RetrieveWorkflow`              | Fully supported with dynamic ui schema in response.<br><br>OpenAPI compliant schema and attributes available in property `formattedSchema` and `formattedAttributes` respectively.                                                                                                                         |  Yes   |
| [Cancel a Workflow](https://developer.ironcladapp.com/reference/cancel-a-workflow)                                                       | `POST`  | `/workflows/{Workflow}/cancel`                             |    S    | `CancelWorkflow`                |                                                                                                                                                                                                                                                                                                            |   No   |
| [Pause a Workflow](https://developer.ironcladapp.com/reference/pause-a-workflow)                                                         | `POST`  | `/workflows/{Workflow}/pause`                              |    S    | `PauseWorkflow`                 |                                                                                                                                                                                                                                                                                                            |   No   |
| [Resume a Workflow](https://developer.ironcladapp.com/reference/resume-a-workflow)                                                       | `POST`  | `/workflows/{Workflow}/resume`                             |    S    | `ResumeWorkflow`                |                                                                                                                                                                                                                                                                                                            |   No   |
| [Revert a Workflow to the Review Step](https://developer.ironcladapp.com/reference/revert-to-review)                                     | `PATCH` | `/workflows/{Workflow}/revert-to-review`                   |    S    | `RevertToReview`                |                                                                                                                                                                                                                                                                                                            |   No   |
| [List All Workflow Approvals](https://developer.ironcladapp.com/reference/list-all-workflow-approvals)                                   | `GET`   | `/workflows/{Workflow}/approvals`                          |    S    | `ListWorkflowApprovals`         |                                                                                                                                                                                                                                                                                                            |  Yes   |
| [Update Approval on a Workflow](https://developer.ironcladapp.com/reference/update-workflow-approval)                                    | `PATCH` | `/workflows/{Workflow}/approvals/{Role}`                   |    S    | `UpdateWorkflowApprovals`       | Fully supported with dynamic role selection.                                                                                                                                                                                                                                                               |   No   |
| [List all Comments on a Workflow](https://developer.ironcladapp.com/reference/list-all-comments-in-a-workflow)                           | `GET`   | `/workflows/{Workflow}/comments`                           |    S    | `ListWorkflowComments`          |                                                                                                                                                                                                                                                                                                            |   No   |
| [Create a Comment on a Workflow](https://developer.ironcladapp.com/reference/create-a-comment-on-a-workflow)                             | `POST`  | `/workflows/{Workflow}/comments`                           |    S    | `CreateComment`                 |                                                                                                                                                                                                                                                                                                            |   No   |
| [List a Comment from a Specified Workflow](https://developer.ironcladapp.com/reference/list-a-comment-from-a-workflow)                   | `GET`   | `/workflows/{Workflow}/comments/{Comment}`                 |    S    | `RetrieveComment`               |                                                                                                                                                                                                                                                                                                            |   No   |
| [List All Workflow Participants](https://developer.ironcladapp.com/reference/list-all-workflow-participants)                             | `GET`   | `/workflows/{Workflow}/participants`                       |    S    | `ListWorkflowParticipants`      |                                                                                                                                                                                                                                                                                                            |   No   |
| [List All Workflow Signers](https://developer.ironcladapp.com/reference/list-all-workflow-signers)                                       | `GET`   | `/workflows/{Workflow}/signatures`                         |    S    | `ListWorkflowSignatures`        |                                                                                                                                                                                                                                                                                                            |   No   |
| [Retrieve a Workflow Document](https://developer.ironcladapp.com/reference/retrieve-a-workflow-document)                                 | `GET`   | `/workflows/{Workflow}/document/{Key}/download`            |    S    | `RetrieveWorkflowDocument`      |                                                                                                                                                                                                                                                                                                            |   No   |
| [Retrieve the Turn History on a Workflow](https://developer.ironcladapp.com/reference/turn-history)                                      | `GET`   | `/workflows/{Workflow}/turn-history`                       |    S    | `ListTurnHistory`               |                                                                                                                                                                                                                                                                                                            |   No   |
| [List All Workflow Schemas](https://developer.ironcladapp.com/reference/list-all-workflow-schemas)                                       | `GET`   | `/workflow-schemas`                                        |    S    | `ListWorkflowSchemas`           |                                                                                                                                                                                                                                                                                                            |   No   |
| [Retrieve a Workflow Schema](https://developer.ironcladapp.com/reference/retrieve-a-workflow-schema)                                     | `GET`   | `/workflow-schemas/{Schema}`                               |    S    | `RetrieveWorkflowSchema`        | OpenAPI compliant schema available in property `formattedSchema`.                                                                                                                                                                                                                                          |  Yes   |
| [Retrieve Email Threads from A Workflow](https://developer.ironcladapp.com/reference/retrieve-email-threads-from-workflow)               | `GET`   | `/workflows/{id}/emails`                                   |    S    | `RetrieveEmailThreads`          |                                                                                                                                                                                                                                                                                                            |   No   |
| [Retrieve an Email Thread from a Specified Workflow](https://developer.ironcladapp.com/reference/retrieve-email-thread-from-workflow)    | `GET`   | `/workflows/{id}/emails/{Thread}`                          |    S    | `RetrieveEmailThread`           | Attachment key is added to attachment object using script.                                                                                                                                                                                                                                                 |  Yes   |
| [Retrieve an Attachment from an Email Thread](https://developer.ironcladapp.com/reference/retrieve-attachment-from-email-thread)         | `GET`   | `/workflows/{id}/emails/{Thread}/attachments/{Attachment}` |    N    | `RetrieveEmailThreadAttachment` | to-do - at this time, the api endpoint is not working with 404 attachment not found. API documentation states: `The download parameter includes the key at the end of the URL ...emails/{emailThreadId}/attachment/{ATTACHMENT_ID}`, but the response is not formatted this way and the key does not work. |   No   |
| [Update Workflow Metadata](https://developer.ironcladapp.com/reference/update-workflow-metadata)                                         | `PATCH` | `/workflows/{id}/attributes`                               |    P    | `UpdateWorkflowMetadata`        |                                                                                                                                                                                                                                                                                                            |   No   |
| [Create a Signed Document on a Workflow](https://developer.ironcladapp.com/reference/workflow-upload-signed-document)                    | `PATCH` | `/workflows/{id}/upload-signed`                            |    S    | `CreateSignedDocument`          |                                                                                                                                                                                                                                                                                                            |   No   |
| [Retrieve the Approval Requests on a Workflow](https://developer.ironcladapp.com/reference/approval-requests)                            | `GET`   | `/workflows/{id}/approval-requests`                        |    S    | `ListApprovalRequests`          |                                                                                                                                                                                                                                                                                                            |   No   |
| [Create a Document on a Workflow](https://developer.ironcladapp.com/reference/create-a-workflow-document)                                | `POST`  | `/workflows/{id}/documents/{Attribute}`                    |    S    | `CreateWorkflowDocument`        | to-do - at this time, the api endpoint is not working with 500 internal server error                                                                                                                                                                                                                       |   No   |
### Records
| Endpoint                                                                                                                                 | Method   | Path                                   | Support | Operation Id                 | Comments                                                                                                                                                                                                                                                                                  | Script |
| ---------------------------------------------------------------------------------------------------------------------------------------- | -------- | -------------------------------------- | :-----: | :--------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :----: |
| [List All Records](https://developer.ironcladapp.com/reference/list-all-records)                                                         | `GET`    | `/records`                             |    S    | `ListAllRecords`             | Record properties are not parsed dynamically. Use `RetrieveWorkflow` for dynamic schema on response.                                                                                                                                                                                      |   No   |
| [Create a Record](https://developer.ironcladapp.com/reference/create-a-record)                                                           | `POST`   | `/records`                             |    P    | `CreateRecord`               | Supported, but requires implicit values for record properties.                                                                                                                                                                                                                            |   No   |
| [Retrieve Predictions](https://developer.ironcladapp.com/reference/retrieve-import-predictions)                                          | `GET`    | `/records/smart-import`                |    S    | `RerievePredictions`         |                                                                                                                                                                                                                                                                                           |   No   |
| [Retrieve a Record](https://developer.ironcladapp.com/reference/retrieve-a-record)                                                       | `GET`    | `/records/{Record}`                    |    S    | `RetrieveRecord`             | OpenAPI compliant schema and attributes available in property `formattedSchema` and `formattedProperties` respectively. Properties in `formattedProperties/recordProperties`, clauses in `formattedProperties/recordClauses`, and attachments in `formattedProperties/recordAttachments`. |   No   |
| [Replace a Record](https://developer.ironcladapp.com/reference/replace-a-record)                                                         | `PUT`    | `/records/{Record}`                    |    S    | `ReplaceRecord`              | Fully supported with dynamic ui schema.                                                                                                                                                                                                                                                   |   No   |
| [Update Record Metadata](https://developer.ironcladapp.com/reference/update-record-metadata)                                             | `PATCH`  | `/records/{Record}`                    |    S    | `UpdateRecordMetadata`       |                                                                                                                                                                                                                                                                                           |   No   |
| [Delete a Record](https://developer.ironcladapp.com/reference/delete-a-record)                                                           | `DELETE` | `/records/{Record}`                    |    S    | `DeleteRecord`               |                                                                                                                                                                                                                                                                                           |   No   |
| [Export Records](https://developer.ironcladapp.com/reference/export-records)                                                             | `GET`    | `/records/export`                      |    S    | `ExportRecords`              |                                                                                                                                                                                                                                                                                           |   No   |
| [Retrieve Records Schema](https://developer.ironcladapp.com/reference/list-all-records-metadata)                                         | `GET`    | `/records/metadata`                    |    S    | `RetrieveRecordSchemas`      |                                                                                                                                                                                                                                                                                           |   No   |
| [Create a Smart Import Record](https://developer.ironcladapp.com/reference/create-a-smart-import-record)                                 | `POST`   | `/records/smart-import`                |    S    | `CreateSmartImportRecord`    |                                                                                                                                                                                                                                                                                           |   No   |
| [Upload a Smart Import Record to an existing Import](https://developer.ironcladapp.com/reference/create-a-smart-import-record-to-import) | `POST`   | `/records/smart-import/{Import}`       |    S    | `ExistingSmartImportRecord`  |                                                                                                                                                                                                                                                                                           |   No   |
| [Retrieve a Signed Copy on a Record](https://developer.ironcladapp.com/reference/retrieve-an-attachment-on-a-record)                     | `GET`    | `/records/{id}/attachments/signedCopy` |    S    | `RetrieveSignedCopyDocument` |                                                                                                                                                                                                                                                                                           |   No   |
| [Create a Signed Copy on a Record](https://developer.ironcladapp.com/reference/create-an-attachment-on-a-record)                         | `POST`   | `/records/{id}/attachments/signedCopy` |    S    | `CreateSignedCopyDocument`   |                                                                                                                                                                                                                                                                                           |   No   |
| [Delete a Signed Copy on a Record](https://developer.ironcladapp.com/reference/delete-an-attachment-on-a-record)                         | `DELETE` | `/records/{id}/attachments/signedCopy` |    S    | `RemoveSignedCopyDocument`   |                                                                                                                                                                                                                                                                                           |   No   |
| [Retrieve an Attachment on a Record](https://developer.ironcladapp.com/reference/retrieve-an-attachment-on-a-record)                     | `GET`    | `/records/{id}/attachments/{Key}`      |    S    | `RetrieveAttachment`         |                                                                                                                                                                                                                                                                                           |   No   |
| [Create an Attachment on a Record](https://developer.ironcladapp.com/reference/create-an-attachment-on-a-record)                         | `POST`   | `/records/{id}/attachments/{Key}`      |    S    | `CreateAttachment`           |                                                                                                                                                                                                                                                                                           |   No   |
| [Delete an Attachment on a Record](https://developer.ironcladapp.com/reference/delete-an-attachment-on-a-record)                         | `DELETE` | `/records/{id}/attachments/{Key}`      |    S    | `RemoveAttachment`           |                                                                                                                                                                                                                                                                                           |   No   |
### Webhooks

All webhook actions are supported and handled automatically using the connector trigger.
### SCIM (System for Cross-domain Identity Management)
| Endpoint                                                                       | Method   | Path                   | Support | Operation Id    | Comments | Script |
| ------------------------------------------------------------------------------ | -------- | ---------------------- | :-----: | --------------- | -------- | :----: |
| [List all Users](https://developer.ironcladapp.com/reference/list-users)       | `GET`    | `/scim/v2/Users`       |    S    | `ListUsers`     |          |  Yes   |
| [Create a User](https://developer.ironcladapp.com/reference/create-user)       | `POST`   | `/scim/v2/Users`       |    S    | `CreateUser`    |          |   No   |
| [Retrieve a User](https://developer.ironcladapp.com/reference/retrieve-user)   | `GET`    | `/scim/v2/Users/{id}`  |    S    | `RetrieveUser`  |          |   No   |
| [Update User Data](https://developer.ironcladapp.com/reference/update-user)    | `PATCH`  | `/scim/v2/Users/{id}`  |    S    | `UpdateUser`    |          |   No   |
| [Replace a User](https://developer.ironcladapp.com/reference/replace-user)     | `PUT`    | `/scim/v2/Users/{id}`  |    S    | `ReplaceUser`   |          |   No   |
| [Delete a User](https://developer.ironcladapp.com/reference/delete-user)       | `DELETE` | `/scim/v2/Users/{id}`  |    S    | `DeleteUser`    |          |   No   |
| [List all Groups](https://developer.ironcladapp.com/reference/list-groups)     | `GET`    | `/scim/v2/Groups`      |    S    | `ListGroups`    |          |   No   |
| [Create a Group](https://developer.ironcladapp.com/reference/create-group)     | `POST`   | `/scim/v2/Groups`      |    S    | `CreateGroup`   |          |   No   |
| [Retrieve a Group](https://developer.ironcladapp.com/reference/retrieve-group) | `GET`    | `/scim/v2/Groups/{id}` |    S    | `RetrieveGroup` |          |   No   |
| [Update a Group](https://developer.ironcladapp.com/reference/update-group)     | `POST`   | `/scim/v2/Groups/{id}` |    S    | `UpdateGroup`   |          |   No   |
| [Replace a Group](https://developer.ironcladapp.com/reference/replace-group)   | `PUT`    | `/scim/v2/Groups/{id}` |    S    | `ReplaceGroup`  |          |   No   |
| [Delete a Group](https://developer.ironcladapp.com/reference/delete-group)     | `DELETE` | `/scim/v2/Groups/{id}` |    S    | `DeleteGroup`   |          |   No   |
## Usage Notes

- When using client credentials authentication, always specify the Actor (user) in the corresponding action fields to ensure proper authorization and auditing.
- Some endpoints may have limitations or require specific permissions in Ironclad. Refer to the Ironclad API documentation for detailed information on each endpoint's requirements.
- Webhook triggers can be used to create real-time integrations. Ensure your Power Automate flows or Power Apps are designed to handle the webhook payloads correctly.
- For large-scale operations or bulk data processing, consider using asynchronous endpoints where available to avoid timeouts.
## Troubleshooting

- If you encounter authentication issues, double-check that the callback URL is correctly set in both the connector settings and Ironclad admin panel.
- For "Permission Denied" errors, ensure the specified Actor has the necessary permissions in Ironclad for the operation you're attempting.
- When working with custom fields or workflows, make sure the field names and workflow IDs match exactly with those in your Ironclad instance.
## Contributing and Support

This connector is developed by LEG Technologies and Operations at Amadeus IT Group, S.A., with support from Ironclad product management. It is planned for release as an independent publisher connector on Microsoft Power Platform.

For support, contributions, or inquiries:
- Use the repository issues for bug reports or feature requests.
- Contact the development team directly for urgent matters or specialized support.
- Consider contributing to the project by submitting pull requests for improvements or additional features.
## License

Distributed under the MIT License. See `LICENSE` for more information.

---

For more detailed information on Ironclad's API, visit the [Ironclad API documentation](https://developer.ironcladapp.com/reference).

Remember to always test the connector thoroughly in a non-production environment before deploying to production. Regular updates to this connector may be released to support new Ironclad API features or improve existing functionality.

Amadeus